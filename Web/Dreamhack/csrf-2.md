## π“csrf-2

```
μ—¬λ¬ κΈ°λ¥κ³Ό μ…λ ¥λ°›μ€ URLμ„ ν™•μΈν•λ” λ΄‡μ΄ κµ¬ν„λ μ„λΉ„μ¤μ…λ‹λ‹¤.
CSRF μ·¨μ•½μ μ„ μ΄μ©ν•΄ ν”λκ·Έλ¥Ό νλ“ν•μ„Έμ”.
```

/change_password νμ΄μ§€, /login νμ΄μ§€κ°€ μ¶”κ°€λλ‹¤.


#### μ†μ¤μ½”λ“

`username`μ΄ `admin`μΈ κ²½μ° index.htmlμ— FLAG κ°’μ΄ μ¶λ ¥λλ‹¤.

**vuln** νμ΄μ§€λ” "frame", "script", "on" μ„Έ κ°€μ§€ ν‚¤μ›λ“λ¥Ό ν•„ν„°λ§ν•΄ XSS κ³µκ²©μ„ λ§‰λ”λ‹¤.

**flag** νμ΄μ§€λ” POST μ”μ²­μ„ λ³΄λ‚΄λ©΄ `param` νλΌλ―Έν„° κ°’μ„ κ°€μ Έμ¨ λ’¤ `session_id`λ¥Ό μƒμ„±ν•κ³ , μƒμ„±ν• `session_id`λ¥Ό ν‚¤λ΅ μ‚¬μ©ν•μ—¬ `admin` κ°’μ„ `session_storage` λ”•μ…”λ„λ¦¬μ— μ €μ¥ν•λ‹¤.
![](Attachments/A235DD06-4187-4A7C-831A-2A83EC12A5A8.png)

**login** νμ΄μ§€λ” POST μ”μ²­μ„ λ³΄λ‚΄λ©΄, usernameκ³Ό password νλΌλ―Έν„° κ°’μ„ κ°€μ Έμ™€μ„ pwμ™€ λΉ„κµν•λ‹¤.
λ΅κ·ΈμΈμ΄ μ„±κ³µν• κ²½μ°, μ‚¬μ©μλ¥Ό index νμ΄μ§€λ΅ λ¦¬λ‹¤μ΄λ ‰μ…ν•λ„λ΅ μƒλ΅μ΄ μ‘λ‹µ κ°μ²΄(resp)λ¥Ό λ§λ“ λ‹¤.
λ‚μ¤‘μ— μ‚¬μ©μλ¥Ό μ‹λ³„ν•  λ• μ‚¬μ©ν•  `session_id`λ¥Ό λ§λ“¤κ³  `session_id`λ΅  `session_storage`μ— `username`μ„ μ €μ¥ν•λ‹¤.
![](Attachments/69AAAFDA-DF55-480F-B512-955BACED74DA.png)

**change_password** νμ΄μ§€λ” `pw` νλΌλ―Έν„°μ κ°’μ„ κ°€μ Έμ™€μ„ `pw` λ³€μμ— μ €μ¥ν•λ‹¤.
λ λΈλΌμ°μ € μΏ ν‚¤μ—μ„ `sessionid` νλΌλ―Έν„° κ°’μ„ `session_id` λ³€μμ— μ €μ¥ν•λ‹¤.
`session_id`λ¥Ό μ‚¬μ©ν•΄ λ΅κ·ΈμΈν• μ‚¬μ©μλ¥Ό ν™•μΈν•κ³ , `session_storage`μ— μ—†μΌλ©΄ please login λ©”μ‹μ§€λ¥Ό λ„μ΄λ‹¤.
`users[username] = pw` β΅οΈ μ„Έμ…μ„ ν†µν•΄ ν™•μΈλ μ΄μ©μμ λΉ„λ°€λ²νΈλ¥Ό μƒλ΅μ΄ λΉ„λ°€λ²νΈ `pw`λ΅ λ³€κ²½ν•λ‹¤.
![](Attachments/94F6A958-2A39-49F0-8DB0-336D861D4FB8.png)


#### μ·¨μ•½μ 

vuln νμ΄μ§€λ” μ΄μ©μμ μ…λ ¥κ°’μ„ κ·Έλ€λ΅ μ¶λ ¥ν•λ―€λ΅ CSRF κ³µκ²©μ„ μν–‰ν•  μ μλ‹¤.


#### ν•΄κ²°

flag νμ΄μ§€μ—μ„ `admin`μ `session_id`κ°€ μ €μ¥λλ―€λ΅, flag νμ΄μ§€μ—μ„ `admin`μ λΉ„λ°€λ²νΈλ¥Ό λ³€κ²½ν•κΈ° μ„ν•΄μ„λ” change_password νμ΄μ§€λ¥Ό μ ‘κ·Όν•΄μ•Ό ν•λ‹¤.
flag νμ΄μ§€λ¥Ό λ°©λ¬Έν•λ” μ΄μ©μκ°€ change_password νμ΄μ§€λ΅ μ”μ²­μ„ μ „μ†΅ν•λ„λ΅ CSRF κ³µκ²© μ½”λ“λ¥Ό μ‘μ„±ν•λ‹¤.

```html
<img src="/change_password?pw=admin" />
```

flag νμ΄μ§€μ—μ„ κ³µκ²© μ½”λ“λ¥Ό μ „μ†΅ν•λ‹¤.
login νμ΄μ§€μ—μ„ μ΅°μ‘ν• pw κ°’μΌλ΅ `admin`μ— λ΅κ·ΈμΈν•λ©΄ FLAGκ°€ μ¶λ ¥λλ‹¤.

![](Attachments/9E9D25F5-D34D-46EE-A96E-C3EEFAC10E8D.png)

